<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="description" content="Notes from the C programming language">
<link rel="alternate"
      type="application/rss+xml"
      href="https://alexb7711.github.io/rss.xml"
      title="RSS feed for https://alexb7711.github.io">
<title>The C Programming Language Notes</title>
<meta name="author" content="Alex Brown">
<meta name="referrer" content="no-referrer">
<link href= "Theme/style.css" rel="stylesheet" type="text/css" />
<link rel="icon" href="~/Videos/StreamingAssets/Profile.png"></head>
<body>
<div id="preamble" class="status"><div class="header">
  <a href="https://alexb7711.github.io">Created with Emacs</a>
</div></div>
<div id="content">
<div class="post-date">17 May 2021</div><h1 class="post-title"><a href="https://alexb7711.github.io/2020-04-30-The-C-Programming-Language-Notes.html">The C Programming Language Notes</a></h1>
<nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org3990e2c">Types, Operators, and Expressions</a>
<ul>
<li><a href="#orgb5273e4">Constants</a></li>
<li><a href="#orgbdc1cd5">Increment and Decrement Operators</a></li>
<li><a href="#orgfcc7d8d">Bitwise Operators</a></li>
</ul>
</li>
<li><a href="#org546387c">Control Flow</a>
<ul>
<li><a href="#org86979e0">Break and Continue</a></li>
<li><a href="#orgc9d37fd">GoTo and Labels</a></li>
</ul>
</li>
<li><a href="#org4b521c0">Functions and Program Structure</a>
<ul>
<li><a href="#orgf990b75">Static Variables</a></li>
</ul>
</li>
<li><a href="#org7f7ebb7">Types, Operators, and Expressions</a>
<ul>
<li><a href="#orge098547">Constants</a></li>
<li><a href="#orgef71797">Increment and Decrement Operators</a></li>
<li><a href="#org79e7245">Bitwise Operators</a></li>
</ul>
</li>
<li><a href="#orgfc455b0">Control Flow</a>
<ul>
<li><a href="#org62703ac">Break and Continue</a></li>
<li><a href="#orge7e65ec">GoTo and Labels</a></li>
</ul>
</li>
<li><a href="#org70b05c0">Functions and Program Structure</a>
<ul>
<li><a href="#org3a7ff70">Static Variables</a></li>
</ul>
</li>
<li><a href="#orgac22ccf">Pointers and Arrays</a>
<ul>
<li><a href="#org5b331c7">Address Arithmetic</a></li>
<li><a href="#org7e4f7ad">Character Pointers and Functions</a></li>
<li><a href="#org90179c8">Pointer Arrays; Pointers to Pointers</a></li>
<li><a href="#org232f73a">Multi-Dimensional Arrays</a></li>
<li><a href="#org5d1c578">Initialization of Pointer Arrays</a></li>
<li><a href="#org94450c6">Pointers vs. Multi-Dimensional Array</a></li>
<li><a href="#org72136b8">Command Line Arguments</a></li>
<li><a href="#org37e0a30">Pointers To Functions</a></li>
<li><a href="#org3d1e9a1">Complicated Declarations</a></li>
</ul>
</li>
<li><a href="#orga6de34c">Structures</a>
<ul>
<li><a href="#org68af864">Arrays of Structures</a></li>
<li><a href="#org85040a5">Table Lookup</a></li>
</ul>
</li>
<li><a href="#org89e7116">Input and Output</a>
<ul>
<li><a href="#orgf7771d7">Command Execution</a></li>
<li><a href="#orgc004e30">Storage Management</a></li>
</ul>
</li>
<li><a href="#orgf473efd">The UNIX System Interface</a>
<ul>
<li><a href="#org2c2ddde">Open, Creat, Close, Unlink</a></li>
<li><a href="#org4be1eca">Random Access - Lseek</a></li>
<li><a href="#orgfc2f1d0">Example - A Storage Allocator</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<p>
&#x2014;
</p>

<p>
I mostly code in C++ and never <i>really</i> spent the time to learn the nuances of C. I recently read through [The C Programming Language](<a href="https://www.amazon.com/dp/0131103628?tag=duckduckgo-brave-20&amp;linkCode=osi&amp;th=1&amp;psc=1">https://www.amazon.com/dp/0131103628?tag=duckduckgo-brave-20&amp;linkCode=osi&amp;th=1&amp;psc=1</a>) and spent the time taking notes. Below is what I found useful and relevant. All diagrams and code snippets are from [The C Programming Language](<a href="https://www.amazon.com/dp/0131103628?tag=duckduckgo-brave-20&amp;linkCode=osi&amp;th=1&amp;psc=1">https://www.amazon.com/dp/0131103628?tag=duckduckgo-brave-20&amp;linkCode=osi&amp;th=1&amp;psc=1</a>).
</p>

<div id="outline-container-org3990e2c" class="outline-2">
<h2 id="org3990e2c">Types, Operators, and Expressions</h2>
<div class="outline-text-2" id="text-org3990e2c">
</div>
<div id="outline-container-orgb5273e4" class="outline-3">
<h3 id="orgb5273e4">Constants</h3>
<div class="outline-text-3" id="text-orgb5273e4">
<p>
A character constant is an integer, written as one character within single quotes such as &rsquo;x&rsquo;. The value of a character constant is the numeric value of the character in the machine&rsquo;s character set. For example, &rsquo;0&rsquo; has the value 48 in ASCII.
</p>

<p>
Certain characters can be expressed in character and string constants by escape sequences like `\n`. In addition, an arbitrary byte-sized bit pattern can be specified by `\ooo`, where `ooo` is one to three octal digits (0&#x2026;7) or by `\xhh` where `hh` is one or more hexadecimal digits (0..9, a&#x2026;f, A&#x2026;F). So as an example, you can write:
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #0000ff; font-weight: bold;">#define</span> <span style="color: #ffff00;">VTAB</span> <span style="color: #00ff00;">'\013'</span> <span style="color: #ffff00;">// </span><span style="color: #ffff00;">ASCII vertical tab</span>
<span style="color: #0000ff; font-weight: bold;">#define</span> <span style="color: #ffff00;">BELL</span> <span style="color: #00ff00;">'\007'</span> <span style="color: #ffff00;">// </span><span style="color: #ffff00;">ASCII bell character</span>
</pre>
</div>

<p>
or in hexadecimal,
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #0000ff; font-weight: bold;">#define</span> <span style="color: #ffff00;">VTAB</span> <span style="color: #00ff00;">'\xb'</span>  <span style="color: #ffff00;">// </span><span style="color: #ffff00;">ASCII vertical tab</span>
<span style="color: #0000ff; font-weight: bold;">#define</span> <span style="color: #ffff00;">BELL</span> <span style="color: #00ff00;">'\x7'</span>  <span style="color: #ffff00;">// </span><span style="color: #ffff00;">ASCII bell character</span>
</pre>
</div>

<p>
The complete set of escape sequences is:
</p>

<p>
#+begin<sub>example</sub>
\a       alert (bell) character
\b       backspace
\f       formfeed
\n       newline
\r       carriage return
\t       horizontal tab
\v       vertical tab
\\       backslash
\?       question mark
\′       single quote
\&ldquo;       double quote
\0	 null character
\ooo  octal number
\xhh  hexadecimal number
#+end<sub>src</sub>
</p>
</div>
</div>

<div id="outline-container-orgbdc1cd5" class="outline-3">
<h3 id="orgbdc1cd5">Increment and Decrement Operators</h3>
<div class="outline-text-3" id="text-orgbdc1cd5">
<p>
An example of when to use `++i` rather than `i++`:
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #ffff00;">/* </span><span style="color: #ffff00;">squeeze:  delete all c from s</span><span style="color: #ffff00;"> */</span>

<span style="color: #00ff00;">void</span> <span style="color: #0000ff; font-weight: bold;">squeeze</span><span style="color: #8c8c8c;">(</span><span style="color: #00ff00;">char</span> <span style="color: #ffff00;">s</span><span style="color: #93a8c6;">[]</span>, <span style="color: #00ff00;">int</span> <span style="color: #ffff00;">c</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">{</span>

    <span style="color: #00ff00;">int</span> <span style="color: #ffff00;">i</span>, <span style="color: #ffff00;">j</span>;



    <span style="color: #00ffff; font-weight: bold;">for</span> <span style="color: #93a8c6;">(</span>i = j = <span style="color: #ff00ff;">0</span>; s<span style="color: #b0b1a3;">[</span>i<span style="color: #b0b1a3;">]</span> != &#8242;\<span style="color: #ff00ff;">0</span>&#8242;; i++<span style="color: #93a8c6;">)</span>

        <span style="color: #00ffff; font-weight: bold;">if</span> <span style="color: #93a8c6;">(</span>s<span style="color: #b0b1a3;">[</span>i<span style="color: #b0b1a3;">]</span> != c<span style="color: #93a8c6;">)</span>

            s<span style="color: #93a8c6;">[</span>j++<span style="color: #93a8c6;">]</span> = s<span style="color: #93a8c6;">[</span>i<span style="color: #93a8c6;">]</span>;

    s<span style="color: #93a8c6;">[</span>j<span style="color: #93a8c6;">]</span> = &#8242;\<span style="color: #ff00ff;">0</span>&#8242;;

<span style="color: #8c8c8c;">}</span>
</pre>
</div>

<p>
This is the same code as:
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #00ffff; font-weight: bold;">if</span> <span style="color: #8c8c8c;">(</span>s<span style="color: #93a8c6;">[</span>i<span style="color: #93a8c6;">]</span> != c<span style="color: #8c8c8c;">)</span>
<span style="color: #8c8c8c;">{</span>

    s<span style="color: #93a8c6;">[</span>j<span style="color: #93a8c6;">]</span> = s<span style="color: #93a8c6;">[</span>i<span style="color: #93a8c6;">]</span>;

    j++;

<span style="color: #8c8c8c;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfcc7d8d" class="outline-3">
<h3 id="orgfcc7d8d">Bitwise Operators</h3>
<div class="outline-text-3" id="text-orgfcc7d8d">
<p>
C provides six operators for bit manipulation; these may only be applied to integral operands, that is, `char`, `short`, `int`, and `long`, whether signed or unsigned.
</p>

<pre class="example" id="orgecb6ad2">
&amp;    bitwise AND
|    bitwise inclusive OR
^    bitwise exclusive OR
&lt;&lt;   left shift
&gt;&gt;   right shift
~    one’s complement (unary)
</pre>

<p>
`~` yield&rsquo;s one&rsquo;s compliment of an integer; that is, it converts each 1-bit into a 0-bit and vice versa.
</p>
</div>
</div>
</div>

<div id="outline-container-org546387c" class="outline-2">
<h2 id="org546387c">Control Flow</h2>
<div class="outline-text-2" id="text-org546387c">
</div>
<div id="outline-container-org86979e0" class="outline-3">
<h3 id="org86979e0">Break and Continue</h3>
<div class="outline-text-3" id="text-org86979e0">
<p>
The `break` statement provides an early exit from `for`, `while`, and `do`, just as it does from `switch`. <b><b>A `break` causes the innermost enclosing loop or switch to be exited immediately.</b></b>
</p>

<p>
The `continue` statement is related to `break`, but less often used; <b><b>it causes the next iteration of the enclosing `for`, `while`, or `do` loop to begin.</b></b> In the `while` and `do`, this means that the test part is executed immediately; in the `for`, control passes to the increment step. This statement only applies to loops, not to a `switch`.
</p>
</div>
</div>

<div id="outline-container-orgc9d37fd" class="outline-3">
<h3 id="orgc9d37fd">GoTo and Labels</h3>
<div class="outline-text-3" id="text-orgc9d37fd">
<p>
`goto` is almost never needed, but it can be useful in situations such as abandoning a process in some deeply nested structure, such as breaking out of two or more loops at once as shown below:
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #00ffff; font-weight: bold;">for</span> <span style="color: #8c8c8c;">(</span> ... <span style="color: #8c8c8c;">)</span>

    <span style="color: #00ffff; font-weight: bold;">for</span> <span style="color: #8c8c8c;">(</span> ... <span style="color: #8c8c8c;">)</span> <span style="color: #8c8c8c;">{</span>

        ...

        <span style="color: #00ffff; font-weight: bold;">if</span> <span style="color: #93a8c6;">(</span>disaster<span style="color: #93a8c6;">)</span>

            <span style="color: #00ffff; font-weight: bold;">goto</span> <span style="color: #ff00ff;">error</span>;

    <span style="color: #8c8c8c;">}</span>

...

error:
    <span style="color: #ffff00;">// </span><span style="color: #ffff00;">Clean up the mess</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4b521c0" class="outline-2">
<h2 id="org4b521c0">Functions and Program Structure</h2>
<div class="outline-text-2" id="text-org4b521c0">
</div>
<div id="outline-container-orgf990b75" class="outline-3">
<h3 id="orgf990b75">Static Variables</h3>
<div class="outline-text-3" id="text-orgf990b75">
<p>
The `static` declaration, applied to an external variable or function, limits the scope of that object to the rest of the source file being compiled
</p>
</div>
</div>
</div>

<div id="outline-container-org7f7ebb7" class="outline-2">
<h2 id="org7f7ebb7">Types, Operators, and Expressions</h2>
<div class="outline-text-2" id="text-org7f7ebb7">
</div>
<div id="outline-container-orge098547" class="outline-3">
<h3 id="orge098547">Constants</h3>
<div class="outline-text-3" id="text-orge098547">
<p>
A character constant is an integer, written as one character within single quotes such as &rsquo;x&rsquo;. The value of a character constant is the numeric value of the character in the machine&rsquo;s character set. For example, &rsquo;0&rsquo; has the value 48 in ASCII.
</p>

<p>
Certain characters can be expressed in character and string constants by escape sequences like `\n`. In addition, an arbitrary byte-sized bit pattern can be specified by `\ooo`, where `ooo` is one to three octal digits (0&#x2026;7) or by `\xhh` where `hh` is one or more hexadecimal digits (0..9, a&#x2026;f, A&#x2026;F). So as an example, you can write:
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #0000ff; font-weight: bold;">#define</span> <span style="color: #ffff00;">VTAB</span> <span style="color: #00ff00;">'\013'</span> <span style="color: #ffff00;">// </span><span style="color: #ffff00;">ASCII vertical tab</span>
<span style="color: #0000ff; font-weight: bold;">#define</span> <span style="color: #ffff00;">BELL</span> <span style="color: #00ff00;">'\007'</span> <span style="color: #ffff00;">// </span><span style="color: #ffff00;">ASCII bell character</span>
</pre>
</div>

<p>
or in hexadecimal,
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #0000ff; font-weight: bold;">#define</span> <span style="color: #ffff00;">VTAB</span> <span style="color: #00ff00;">'\xb'</span>  <span style="color: #ffff00;">// </span><span style="color: #ffff00;">ASCII vertical tab</span>
<span style="color: #0000ff; font-weight: bold;">#define</span> <span style="color: #ffff00;">BELL</span> <span style="color: #00ff00;">'\x7'</span>  <span style="color: #ffff00;">// </span><span style="color: #ffff00;">ASCII bell character</span>
</pre>
</div>

<p>
The complete set of escape sequences is:
</p>

<pre class="example" id="org8434c57">
\a       alert (bell) character
\b       backspace
\f       formfeed
\n       newline
\r       carriage return
\t       horizontal tab
\v       vertical tab
\\       backslash
\?       question mark
\′       single quote
\"       double quote
\0	 null character
\ooo	 octal number
\xhh	 hexadecimal number
</pre>
</div>
</div>

<div id="outline-container-orgef71797" class="outline-3">
<h3 id="orgef71797">Increment and Decrement Operators</h3>
<div class="outline-text-3" id="text-orgef71797">
<p>
An example of when to use `++i` rather than `i++`:
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #ffff00;">/* </span><span style="color: #ffff00;">squeeze:  delete all c from s</span><span style="color: #ffff00;"> */</span>

<span style="color: #00ff00;">void</span> <span style="color: #0000ff; font-weight: bold;">squeeze</span><span style="color: #8c8c8c;">(</span><span style="color: #00ff00;">char</span> <span style="color: #ffff00;">s</span><span style="color: #93a8c6;">[]</span>, <span style="color: #00ff00;">int</span> <span style="color: #ffff00;">c</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">{</span>

    <span style="color: #00ff00;">int</span> <span style="color: #ffff00;">i</span>, <span style="color: #ffff00;">j</span>;



    <span style="color: #00ffff; font-weight: bold;">for</span> <span style="color: #93a8c6;">(</span>i = j = <span style="color: #ff00ff;">0</span>; s<span style="color: #b0b1a3;">[</span>i<span style="color: #b0b1a3;">]</span> != &#8242;\<span style="color: #ff00ff;">0</span>&#8242;; i++<span style="color: #93a8c6;">)</span>

        <span style="color: #00ffff; font-weight: bold;">if</span> <span style="color: #93a8c6;">(</span>s<span style="color: #b0b1a3;">[</span>i<span style="color: #b0b1a3;">]</span> != c<span style="color: #93a8c6;">)</span>

            s<span style="color: #93a8c6;">[</span>j++<span style="color: #93a8c6;">]</span> = s<span style="color: #93a8c6;">[</span>i<span style="color: #93a8c6;">]</span>;

    s<span style="color: #93a8c6;">[</span>j<span style="color: #93a8c6;">]</span> = &#8242;\<span style="color: #ff00ff;">0</span>&#8242;;

<span style="color: #8c8c8c;">}</span>
</pre>
</div>

<p>
This is the same code as:
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #00ffff; font-weight: bold;">if</span> <span style="color: #8c8c8c;">(</span>s<span style="color: #93a8c6;">[</span>i<span style="color: #93a8c6;">]</span> != c<span style="color: #8c8c8c;">)</span>
<span style="color: #8c8c8c;">{</span>

    s<span style="color: #93a8c6;">[</span>j<span style="color: #93a8c6;">]</span> = s<span style="color: #93a8c6;">[</span>i<span style="color: #93a8c6;">]</span>;

    j++;

<span style="color: #8c8c8c;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org79e7245" class="outline-3">
<h3 id="org79e7245">Bitwise Operators</h3>
<div class="outline-text-3" id="text-org79e7245">
<p>
C provides six operators for bit manipulation; these may only be applied to integral operands, that is, `char`, `short`, `int`, and `long`, whether signed or unsigned.
</p>

<pre class="example" id="orgf3e8b5c">
&amp;    bitwise AND
|    bitwise inclusive OR
^    bitwise exclusive OR
&lt;&lt;   left shift
&gt;&gt;   right shift
~    one’s complement (unary)
</pre>

<p>
`~` yield&rsquo;s one&rsquo;s compliment of an integer; that is, it converts each 1-bit into a 0-bit and vice versa.
</p>
</div>
</div>
</div>

<div id="outline-container-orgfc455b0" class="outline-2">
<h2 id="orgfc455b0">Control Flow</h2>
<div class="outline-text-2" id="text-orgfc455b0">
</div>
<div id="outline-container-org62703ac" class="outline-3">
<h3 id="org62703ac">Break and Continue</h3>
<div class="outline-text-3" id="text-org62703ac">
<p>
The `break` statement provides an early exit from `for`, `while`, and `do`, just as it does from `switch`. <b><b>A `break` causes the innermost enclosing loop or switch to be exited immediately.</b></b>
</p>

<p>
The `continue` statement is related to `break`, but less often used; <b><b>it causes the next iteration of the enclosing `for`, `while`, or `do` loop to begin.</b></b> In the `while` and `do`, this means that the test part is executed immediately; in the `for`, control passes to the increment step. This statement only applies to loops, not to a `switch`.
</p>
</div>
</div>

<div id="outline-container-orge7e65ec" class="outline-3">
<h3 id="orge7e65ec">GoTo and Labels</h3>
<div class="outline-text-3" id="text-orge7e65ec">
<p>
`goto` is almost never needed, but it can be useful in situations such as abandoning a process in some deeply nested structure, such as breaking out of two or more loops at once as shown below:
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #00ffff; font-weight: bold;">for</span> <span style="color: #8c8c8c;">(</span> ... <span style="color: #8c8c8c;">)</span>

    <span style="color: #00ffff; font-weight: bold;">for</span> <span style="color: #8c8c8c;">(</span> ... <span style="color: #8c8c8c;">)</span> <span style="color: #8c8c8c;">{</span>

        ...

        <span style="color: #00ffff; font-weight: bold;">if</span> <span style="color: #93a8c6;">(</span>disaster<span style="color: #93a8c6;">)</span>

            <span style="color: #00ffff; font-weight: bold;">goto</span> <span style="color: #ff00ff;">error</span>;

    <span style="color: #8c8c8c;">}</span>

...

error:
    <span style="color: #ffff00;">// </span><span style="color: #ffff00;">Clean up the mess</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org70b05c0" class="outline-2">
<h2 id="org70b05c0">Functions and Program Structure</h2>
<div class="outline-text-2" id="text-org70b05c0">
</div>
<div id="outline-container-org3a7ff70" class="outline-3">
<h3 id="org3a7ff70">Static Variables</h3>
<div class="outline-text-3" id="text-org3a7ff70">
<p>
&lt;&lt;&lt;&lt;&lt;&lt;&lt; Updated upstream
The `static` declaration, applied to an external variable or function, limits the scope of that object to the rest of the source file being compiled.
<code>=====</code>
The `static` declaration, applied to an external variable or function, limits the scope of that object to the rest of the source file being compiled
</p>
</div>
</div>
</div>

<div id="outline-container-orgac22ccf" class="outline-2">
<h2 id="orgac22ccf">Pointers and Arrays</h2>
<div class="outline-text-2" id="text-orgac22ccf">
<p>
In C, there is a strong relationship between pointers and arrays. Any operation that can be achieved by array subscripting can also be done with pointers. The pointer version will generally be faster, but at least to the uninitiated, somewhat harder to understand.
</p>

<p>
If you look at an array, indexing it via `array[i]`, is the same way as indexing it via `&amp;array[0] + i`. `&amp;array[0]`, is the pointer to the first item in the array, if we have a value I added on to it, that will move down the array as shown in Figure \ref{fig:arraypointerexample}
</p>

<p>
![Using pointers to index an array \label{fig:arraypointerexample}](<img src="https://learning.oreilly.com/library/view/the-c-programming/9780133086249/graphics/98med03.jpg" alt="98med03.jpg">)
</p>

<p>
Using this line of thinking, it is possible to then pass part of an array to a function:
</p>

<div class="org-src-container">
<pre class="src src-C">foo<span style="color: #8c8c8c;">(</span>&amp;a<span style="color: #93a8c6;">[</span><span style="color: #ff00ff;">2</span><span style="color: #93a8c6;">]</span><span style="color: #8c8c8c;">)</span>;
<span style="color: #ffff00;">// </span><span style="color: #ffff00;">or</span>
<span style="color: #0000ff; font-weight: bold;">foo</span><span style="color: #8c8c8c;">(</span>a+<span style="color: #ff00ff;">2</span><span style="color: #8c8c8c;">)</span>;
</pre>
</div>

<p>
Where the function `foo`&rsquo;s arguments have the form of:
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #0000ff; font-weight: bold;">foo</span><span style="color: #8c8c8c;">(</span><span style="color: #00ff00;">int</span> <span style="color: #ffff00;">arr</span><span style="color: #93a8c6;">[]</span><span style="color: #8c8c8c;">)</span> <span style="color: #8c8c8c;">{</span>...<span style="color: #8c8c8c;">}</span>
<span style="color: #ffff00;">// </span><span style="color: #ffff00;">or</span>
<span style="color: #0000ff; font-weight: bold;">fo</span><span style="color: #8c8c8c;">(</span><span style="color: #00ff00;">int</span>* <span style="color: #ffff00;">arr</span><span style="color: #8c8c8c;">)</span> <span style="color: #8c8c8c;">{</span>...<span style="color: #8c8c8c;">}</span>
</pre>
</div>

<p>
As far as `foo` is concerned, the fact that the parameter refers to part of a larger array is of no consequence.
</p>
</div>

<div id="outline-container-org5b331c7" class="outline-3">
<h3 id="org5b331c7">Address Arithmetic</h3>
<div class="outline-text-3" id="text-org5b331c7">
<p>
Because memory is allocated sequentially, we can use mathematical comparisons to see if we have enough memory allocated in a buffer, to see a position of a value in an array, etc. For example:
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #00ffff; font-weight: bold;">if</span> <span style="color: #8c8c8c;">(</span>allocbuf + <span style="color: #ff00ff;">ALLOCSIZE</span> - allocp &gt;= n<span style="color: #8c8c8c;">)</span>     <span style="color: #ffff00;">// </span><span style="color: #ffff00;">Checks if the buffer is large enough</span>
<span style="color: #ffff00;">// </span><span style="color: #ffff00;">or</span>
<span style="color: #00ffff; font-weight: bold;">if</span> <span style="color: #8c8c8c;">(</span>p &gt;= allocbuf &amp;&amp; p &lt; allocbuf + <span style="color: #ff00ff;">ALLOCSIZE</span><span style="color: #8c8c8c;">)</span>  <span style="color: #ffff00;">// </span><span style="color: #ffff00;">Checks if the pointer is within the buffer range</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7e4f7ad" class="outline-3">
<h3 id="org7e4f7ad">Character Pointers and Functions</h3>
<div class="outline-text-3" id="text-org7e4f7ad">
<p>
A string constant is written as `&ldquo;I am a string&rdquo;`. It is represented as an array of characters and is terminated with a `\0`.
</p>

<p>
When a character string appears, it is accessed through a character pointer. For example
</p>

<div class="org-src-container">
<pre class="src src-C">printf<span style="color: #8c8c8c;">(</span><span style="color: #00ff00;">"Hello, World!\n"</span><span style="color: #8c8c8c;">)</span>;
</pre>
</div>

<p>
takes the pointer of the start of the character string.
</p>

<p>
If you declare a character pointer as follows:
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #00ff00;">char</span>* <span style="color: #ffff00;">pmessage</span>;
</pre>
</div>

<p>
then the statement
</p>

<div class="org-src-container">
<pre class="src src-C">pmessage = <span style="color: #00ff00;">"Hello, World!"</span>;
</pre>
</div>

<p>
Assigns `pmessage` to the &ldquo;Hello, World!&rdquo;. This is <b>not</b> a copy; only pointers are involved. C does not provide any operators for processing an entire string of characters as a unit.
</p>
</div>
</div>

<div id="outline-container-org90179c8" class="outline-3">
<h3 id="org90179c8">Pointer Arrays; Pointers to Pointers</h3>
<div class="outline-text-3" id="text-org90179c8">
<p>
To create an array of pointers, we can say:
</p>

<pre class="example" id="org244710e">
char* lineptr[10];	// Array of character pointers
</pre>
</div>
</div>

<div id="outline-container-org232f73a" class="outline-3">
<h3 id="org232f73a">Multi-Dimensional Arrays</h3>
<div class="outline-text-3" id="text-org232f73a">
<p>
C provides rectangular multi-dimensional arrays, although in practice they are much less used than arrays of pointers.
</p>

<p>
**If a two-dimensional array is to be passed to a function, the parameter declaration in the function must include the number of columns; the number of rows is irrelevant, since what is passed is, as before, a pointer to an array of rows.
</p>

<div class="org-src-container">
<pre class="src src-C">foo <span style="color: #8c8c8c;">(</span><span style="color: #00ff00;">int</span> <span style="color: #ffff00;">daytab</span><span style="color: #93a8c6;">[</span><span style="color: #ff00ff;">2</span><span style="color: #93a8c6;">][</span><span style="color: #ff00ff;">13</span><span style="color: #93a8c6;">]</span> <span style="color: #93a8c6;">{</span>...<span style="color: #93a8c6;">}</span>
<span style="color: #ffff00;">// </span><span style="color: #ffff00;">or</span>
foo <span style="color: #93a8c6;">(</span><span style="color: #00ff00;">int</span> <span style="color: #ffff00;">daytab</span><span style="color: #b0b1a3;">[][</span><span style="color: #ff00ff;">13</span><span style="color: #b0b1a3;">]</span> <span style="color: #b0b1a3;">{</span>...<span style="color: #b0b1a3;">}</span>
<span style="color: #ffff00;">// </span><span style="color: #ffff00;">or</span>
foo <span style="color: #b0b1a3;">(</span><span style="color: #00ff00;">int</span> <span style="color: #8c8c8c;">(</span>*<span style="color: #ffff00;">daytab</span><span style="color: #8c8c8c;">)[</span><span style="color: #ff00ff;">13</span><span style="color: #8c8c8c;">]</span> <span style="color: #8c8c8c;">{</span>...<span style="color: #8c8c8c;">}</span>
</pre>
</div>
<p>
It is necessary to have the parenthesis in the last version since brackets `[]` have higher precedence than *. Without the parenthesis
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #00ff00;">int</span>* <span style="color: #ffff00;">daytab</span><span style="color: #8c8c8c;">[</span><span style="color: #ff00ff;">13</span><span style="color: #8c8c8c;">]</span>
</pre>
</div>

<p>
is an array of 13 pointers to integers. More generally, only the first dimension of an array is free; all others have to be specified.
</p>
</div>
</div>

<div id="outline-container-org5d1c578" class="outline-3">
<h3 id="org5d1c578">Initialization of Pointer Arrays</h3>
<div class="outline-text-3" id="text-org5d1c578">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #00ff00;">char</span>* <span style="color: #ffff00;">array_of_pointers</span><span style="color: #8c8c8c;">[]</span> =
<span style="color: #8c8c8c;">{</span>
    <span style="color: #00ff00;">"Item 1"</span>,
    <span style="color: #00ff00;">"Item 2"</span>,
    ...
<span style="color: #8c8c8c;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org94450c6" class="outline-3">
<h3 id="org94450c6">Pointers vs. Multi-Dimensional Array</h3>
<div class="outline-text-3" id="text-org94450c6">
<p>
The big difference between
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #00ff00;">int</span> <span style="color: #ffff00;">a</span><span style="color: #8c8c8c;">[</span><span style="color: #ff00ff;">10</span><span style="color: #8c8c8c;">][</span><span style="color: #ff00ff;">20</span><span style="color: #8c8c8c;">]</span>;
<span style="color: #ffff00;">// </span><span style="color: #ffff00;">and</span>
<span style="color: #00ff00;">int</span>* <span style="color: #ffff00;">b</span><span style="color: #8c8c8c;">[</span><span style="color: #ff00ff;">10</span><span style="color: #8c8c8c;">]</span>;
</pre>
</div>

<p>
Is that the first one allocates all 10x20 array, the second only allocates 10 integer pointers. Initialization must be done explicitly either statically or with code. The important advantage of the pointer array is that the rows of the array may be of different lengths.
</p>
</div>
</div>

<div id="outline-container-org72136b8" class="outline-3">
<h3 id="org72136b8">Command Line Arguments</h3>
<div class="outline-text-3" id="text-org72136b8">
<p>
When `main` is called, it is called with two arguments. The first (conventionally called `argc` for argument count) is the number of command-line arguments. The second (`argv`, for argument vector), is a pointer to an array of character strings that contain the arguments, one per string. We customarily use multiple levels of pointers to manipulate these character strings.
</p>
</div>

<div id="outline-container-org02f01d3" class="outline-4">
<h4 id="org02f01d3">Accepting Command Line Flags</h4>
<div class="outline-text-4" id="text-org02f01d3">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #0000ff; font-weight: bold;">#include</span> <span style="color: #8c8c8c;">&lt;</span><span style="color: #00ff00;">stdio.h</span><span style="color: #8c8c8c;">&gt;</span>

<span style="color: #0000ff; font-weight: bold;">#include</span> <span style="color: #8c8c8c;">&lt;</span><span style="color: #00ff00;">string.h</span><span style="color: #8c8c8c;">&gt;</span>

<span style="color: #0000ff; font-weight: bold;">#define</span> <span style="color: #ffff00;">MAXLINE</span> <span style="color: #ff00ff;">1000</span>



<span style="color: #00ff00;">int</span> <span style="color: #0000ff; font-weight: bold;">getline</span><span style="color: #8c8c8c;">(</span><span style="color: #00ff00;">char</span> *<span style="color: #ffff00;">line</span>, <span style="color: #00ff00;">int</span> <span style="color: #ffff00;">max</span><span style="color: #8c8c8c;">)</span>;



<span style="color: #ffff00;">/* </span><span style="color: #ffff00;">find:  print lines that match pattern from 1st arg</span><span style="color: #ffff00;"> */</span>

<span style="color: #0000ff; font-weight: bold;">main</span><span style="color: #8c8c8c;">(</span><span style="color: #00ff00;">int</span> <span style="color: #ffff00;">argc</span>, <span style="color: #00ff00;">char</span> *<span style="color: #ffff00;">argv</span><span style="color: #93a8c6;">[]</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">{</span>

    <span style="color: #00ff00;">char</span> <span style="color: #ffff00;">line</span><span style="color: #93a8c6;">[</span><span style="color: #ff00ff;">MAXLINE</span><span style="color: #93a8c6;">]</span>;

    <span style="color: #00ff00;">long</span> <span style="color: #ffff00;">lineno</span> = <span style="color: #ff00ff;">0</span>;

    <span style="color: #00ff00;">int</span> <span style="color: #ffff00;">c</span>, <span style="color: #ffff00;">except</span> = <span style="color: #ff00ff;">0</span>, <span style="color: #ffff00;">number</span> = <span style="color: #ff00ff;">0</span>, <span style="color: #ffff00;">found</span> = <span style="color: #ff00ff;">0</span>;



    <span style="color: #00ffff; font-weight: bold;">while</span> <span style="color: #93a8c6;">(</span>--argc &gt; <span style="color: #ff00ff;">0</span> &amp;&amp; <span style="color: #b0b1a3;">(</span>*++argv<span style="color: #b0b1a3;">)[</span><span style="color: #ff00ff;">0</span><span style="color: #b0b1a3;">]</span> == &#8242;-&#8242;<span style="color: #93a8c6;">)</span>

        <span style="color: #00ffff; font-weight: bold;">while</span> <span style="color: #93a8c6;">(</span>c = *++argv<span style="color: #b0b1a3;">[</span><span style="color: #ff00ff;">0</span><span style="color: #b0b1a3;">]</span><span style="color: #93a8c6;">)</span>

            <span style="color: #00ffff; font-weight: bold;">switch</span> <span style="color: #93a8c6;">(</span>c<span style="color: #93a8c6;">)</span> <span style="color: #93a8c6;">{</span>

            <span style="color: #00ffff; font-weight: bold;">case</span> &#8242;x&#8242;:

                except = <span style="color: #ff00ff;">1</span>;

                <span style="color: #00ffff; font-weight: bold;">break</span>;

            <span style="color: #00ffff; font-weight: bold;">case</span> &#8242;n&#8242;:

                number = <span style="color: #ff00ff;">1</span>;

                <span style="color: #00ffff; font-weight: bold;">break</span>;

            <span style="color: #00ffff; font-weight: bold;">default</span>:

                printf<span style="color: #b0b1a3;">(</span><span style="color: #00ff00;">"find: illegal option %c\n"</span>, c<span style="color: #b0b1a3;">)</span>;

                argc = <span style="color: #ff00ff;">0</span>;

                found = &#8722;<span style="color: #ff00ff;">1</span>;

                <span style="color: #00ffff; font-weight: bold;">break</span>;

            <span style="color: #93a8c6;">}</span>

    <span style="color: #00ffff; font-weight: bold;">if</span> <span style="color: #93a8c6;">(</span>argc != <span style="color: #ff00ff;">1</span><span style="color: #93a8c6;">)</span>

        printf<span style="color: #93a8c6;">(</span><span style="color: #00ff00;">"Usage: find -x -n pattern\n"</span><span style="color: #93a8c6;">)</span>;

    <span style="color: #00ffff; font-weight: bold;">else</span>

        <span style="color: #00ffff; font-weight: bold;">while</span> <span style="color: #93a8c6;">(</span>getline<span style="color: #b0b1a3;">(</span>line, <span style="color: #ff00ff;">MAXLINE</span><span style="color: #b0b1a3;">)</span> &gt; <span style="color: #ff00ff;">0</span><span style="color: #93a8c6;">)</span> <span style="color: #93a8c6;">{</span>

            lineno++;

            <span style="color: #00ffff; font-weight: bold;">if</span> <span style="color: #b0b1a3;">(</span><span style="color: #8c8c8c;">(</span>strstr<span style="color: #93a8c6;">(</span>line, *argv<span style="color: #93a8c6;">)</span> != <span style="color: #ff00ff;">NULL</span><span style="color: #8c8c8c;">)</span> != except<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>

                <span style="color: #00ffff; font-weight: bold;">if</span> <span style="color: #8c8c8c;">(</span>number<span style="color: #8c8c8c;">)</span>

                    printf<span style="color: #8c8c8c;">(</span><span style="color: #00ff00;">"%ld:"</span>, lineno<span style="color: #8c8c8c;">)</span>;

                printf<span style="color: #8c8c8c;">(</span><span style="color: #00ff00;">"%s"</span>, line<span style="color: #8c8c8c;">)</span>;

                found++;

            <span style="color: #b0b1a3;">}</span>

        <span style="color: #93a8c6;">}</span>

    <span style="color: #00ffff; font-weight: bold;">return</span> found;

<span style="color: #8c8c8c;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org37e0a30" class="outline-3">
<h3 id="org37e0a30">Pointers To Functions</h3>
<div class="outline-text-3" id="text-org37e0a30">
<p>
In C, it is possible to define pointers to functions which can be assigned, placed in arrays, passed to functions, returned by functions, and so on.
</p>

<p>
The generic `void*` is used for pointer arguments. Any pointer can be cast to `void*` and back again without loss of information.
</p>

<p>
When creating a function that accepts function pointers:
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #00ff00;">void</span> <span style="color: #0000ff; font-weight: bold;">qsort</span> <span style="color: #8c8c8c;">(</span><span style="color: #00ff00;">void</span>* <span style="color: #ffff00;">v</span><span style="color: #93a8c6;">[]</span>, <span style="color: #00ff00;">int</span> <span style="color: #ffff00;">left</span>, <span style="color: #00ff00;">int</span> <span style="color: #ffff00;">right</span>, <span style="color: #00ff00;">int</span> <span style="color: #93a8c6;">(</span>*<span style="color: #0000ff; font-weight: bold;">comp</span><span style="color: #93a8c6;">)(</span><span style="color: #00ff00;">void</span>*, <span style="color: #00ff00;">void</span>*<span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>

<p>
Says that `comp` is a pointer to a function that has two `void*` as arguments.
</p>
</div>
</div>

<div id="outline-container-org3d1e9a1" class="outline-3">
<h3 id="org3d1e9a1">Complicated Declarations</h3>
<div class="outline-text-3" id="text-org3d1e9a1">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #00ff00;">char</span> **<span style="color: #0000ff; font-weight: bold;">argv</span>

    argv:  pointer to pointer to <span style="color: #00ff00;">char</span>

<span style="color: #00ff00;">int</span> <span style="color: #8c8c8c;">(</span>*daytab<span style="color: #8c8c8c;">)[</span><span style="color: #ff00ff;">13</span><span style="color: #8c8c8c;">]</span>

    daytab:  pointer to array<span style="color: #8c8c8c;">[</span><span style="color: #ff00ff;">13</span><span style="color: #8c8c8c;">]</span> of <span style="color: #00ff00;">int</span>

<span style="color: #00ff00;">int</span> *daytab<span style="color: #8c8c8c;">[</span><span style="color: #ff00ff;">13</span><span style="color: #8c8c8c;">]</span>

    daytab:  array<span style="color: #8c8c8c;">[</span><span style="color: #ff00ff;">13</span><span style="color: #8c8c8c;">]</span> of pointer to <span style="color: #00ff00;">int</span>

<span style="color: #00ff00;">void</span> *comp<span style="color: #8c8c8c;">()</span>

    comp:  function returning pointer to <span style="color: #00ff00;">void</span>

<span style="color: #00ff00;">void</span> <span style="color: #8c8c8c;">(</span>*comp<span style="color: #8c8c8c;">)()</span>

    comp:  pointer to function returning <span style="color: #00ff00;">void</span>

<span style="color: #00ff00;">char</span> <span style="color: #8c8c8c;">(</span>*<span style="color: #93a8c6;">(</span>*x<span style="color: #b0b1a3;">()</span><span style="color: #93a8c6;">)[]</span><span style="color: #8c8c8c;">)()</span>

    x: function returning pointer to array<span style="color: #8c8c8c;">[]</span> of

    pointer to function returning <span style="color: #00ff00;">char</span>

<span style="color: #00ff00;">char</span> <span style="color: #8c8c8c;">(</span>*<span style="color: #93a8c6;">(</span>*x<span style="color: #b0b1a3;">[</span><span style="color: #ff00ff;">3</span><span style="color: #b0b1a3;">]</span><span style="color: #93a8c6;">)()</span><span style="color: #8c8c8c;">)[</span><span style="color: #ff00ff;">5</span><span style="color: #8c8c8c;">]</span>

    x: array<span style="color: #8c8c8c;">[</span><span style="color: #ff00ff;">3</span><span style="color: #8c8c8c;">]</span> of pointer to function returning

    pointer to array<span style="color: #8c8c8c;">[</span><span style="color: #ff00ff;">5</span><span style="color: #8c8c8c;">]</span> of <span style="color: #00ff00;">char</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga6de34c" class="outline-2">
<h2 id="orga6de34c">Structures</h2>
<div class="outline-text-2" id="text-orga6de34c">
<p>
A `struct` declaration defines a type. The right brace that terminates the list of members may be followed by a list of variables, just as for any basic type. That is,
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #00ffff; font-weight: bold;">struct</span> <span style="color: #8c8c8c;">{</span>...<span style="color: #8c8c8c;">}</span> <span style="color: #ffff00;">x</span>, <span style="color: #ffff00;">y</span>, <span style="color: #ffff00;">z</span>;
</pre>
</div>

<p>
A structure declaration that is not followed by  a list of variables reserves no storage; it merely describes a template or the shape of a structure. If the declaration is tagged, however; the tag can be used later in definitions of instances of the structure. For example:
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #00ffff; font-weight: bold;">struct</span> <span style="color: #00ff00;">point</span> <span style="color: #ffff00;">pt</span>;
</pre>
</div>

<p>
Is analogous to `int c`.
</p>
</div>

<div id="outline-container-org68af864" class="outline-3">
<h3 id="org68af864">Arrays of Structures</h3>
<div class="outline-text-3" id="text-org68af864">
<p>
When defining an array of structures, it is acceptable to define it in the following manner:
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #00ffff; font-weight: bold;">struct</span> <span style="color: #00ff00;">key</span> <span style="color: #8c8c8c;">{</span>

    <span style="color: #00ff00;">char</span> *<span style="color: #ffff00;">word</span>;

    <span style="color: #00ff00;">int</span> <span style="color: #ffff00;">count</span>;

<span style="color: #8c8c8c;">}</span> <span style="color: #ffff00;">keytab</span><span style="color: #8c8c8c;">[]</span> = <span style="color: #8c8c8c;">{</span>

    <span style="color: #00ff00;">"auto"</span>, <span style="color: #ff00ff;">0</span>,

    <span style="color: #00ff00;">"break"</span>, <span style="color: #ff00ff;">0</span>,

    <span style="color: #00ff00;">"case"</span>, <span style="color: #ff00ff;">0</span>,

    <span style="color: #00ff00;">"char"</span>, <span style="color: #ff00ff;">0</span>,

    <span style="color: #00ff00;">"const"</span>, <span style="color: #ff00ff;">0</span>,

    <span style="color: #00ff00;">"continue"</span>, <span style="color: #ff00ff;">0</span>,

    <span style="color: #00ff00;">"default"</span>, <span style="color: #ff00ff;">0</span>,

    <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">...</span><span style="color: #ffff00;"> */</span>

    <span style="color: #00ff00;">"unsigned"</span>, <span style="color: #ff00ff;">0</span>,

    <span style="color: #00ff00;">"void"</span>, <span style="color: #ff00ff;">0</span>,

    <span style="color: #00ff00;">"volatile"</span>, <span style="color: #ff00ff;">0</span>,

    <span style="color: #00ff00;">"while"</span>, <span style="color: #ff00ff;">0</span>

<span style="color: #8c8c8c;">}</span>;
</pre>
</div>

<p>
However, it is more precise to enclose the initializers for each &ldquo;row&rdquo; or structure in braces:
</p>

<div class="org-src-container">
<pre class="src src-C"> <span style="color: #8c8c8c;">{</span> <span style="color: #00ff00;">"auto"</span>, <span style="color: #ff00ff;">0</span> <span style="color: #8c8c8c;">}</span>,

 <span style="color: #8c8c8c;">{</span> <span style="color: #00ff00;">"break"</span>, <span style="color: #ff00ff;">0</span> <span style="color: #8c8c8c;">}</span>,

 <span style="color: #8c8c8c;">{</span> <span style="color: #00ff00;">"case"</span>, <span style="color: #ff00ff;">0</span> <span style="color: #8c8c8c;">}</span>,

...
</pre>
</div>
</div>
</div>

<div id="outline-container-org85040a5" class="outline-3">
<h3 id="org85040a5">Table Lookup</h3>
<div class="outline-text-3" id="text-org85040a5">
<p>
This section will be about writing the innards of a table-lookup package.
</p>

<p>
There are two routines that manipulate the names and replace texts. `install(s,t)` records the name s and the replacement text `t` in a table; `s` and `t` are just character strings. `lookup(s)` searches for `s` in the table, and returns a pointer to the place where it was found, or `NULL` if it wasn&rsquo;t there.
</p>

<p>
The algorithm is a hash search—the incoming name is converted into a small non-negative integer, which is then used to index into an array of pointers. An array element points to the beginning of a linked list of blocks describing names that have that hash value. It is NULL if no names have hashed to that value.
</p>

<p>
This is shown in Figure \ref{fig:hashtable}.
</p>

<p>
![Diagram of table lookup \label{fig:hashtable}](<img src="https://learning.oreilly.com/library/view/the-c-programming/9780133086249/graphics/f0144_01.jpg" alt="f0144_01.jpg">)
</p>

<p>
A block in the list is a structure containing pointers to the name, the replacement text, and the next blocks in the list. A `NULL` next-pointer marks the end of the list.
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #00ffff; font-weight: bold;">struct</span> <span style="color: #00ff00;">nlist</span> <span style="color: #8c8c8c;">{</span>       <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">table entry:</span><span style="color: #ffff00;"> */</span>

    <span style="color: #00ffff; font-weight: bold;">struct</span> <span style="color: #00ff00;">nlist</span> *<span style="color: #ffff00;">next</span>;   <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">next entry in chain</span><span style="color: #ffff00;"> */</span>

    <span style="color: #00ff00;">char</span> *<span style="color: #ffff00;">name</span>;           <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">defined name</span><span style="color: #ffff00;"> */</span>

    <span style="color: #00ff00;">char</span> *<span style="color: #ffff00;">defn</span>;           <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">replacement text</span><span style="color: #ffff00;"> */</span>

<span style="color: #8c8c8c;">}</span>;
</pre>
</div>

<p>
The pointer array is just
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #0000ff; font-weight: bold;">#define</span> <span style="color: #ffff00;">HASHSIZE</span> <span style="color: #ff00ff;">101</span>

<span style="color: #00ffff; font-weight: bold;">static</span> <span style="color: #00ffff; font-weight: bold;">struct</span> <span style="color: #00ff00;">nlist</span> *<span style="color: #ffff00;">hashtab</span><span style="color: #8c8c8c;">[</span><span style="color: #ff00ff;">HASHSIZE</span><span style="color: #8c8c8c;">]</span>;    <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">pointer table</span><span style="color: #ffff00;"> */</span>
</pre>
</div>

<p>
The hashing function, which is used by both `lookup` and `install`, adds each character value in the string to a scrambled combination of the previous ones and returns the remainder modulo the array size.
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #ffff00;">/* </span><span style="color: #ffff00;">hash:  form hash value for string s</span><span style="color: #ffff00;"> */</span>

<span style="color: #00ff00;">unsigned</span> <span style="color: #0000ff; font-weight: bold;">hash</span><span style="color: #8c8c8c;">(</span><span style="color: #00ff00;">char</span> *<span style="color: #ffff00;">s</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">{</span>

    <span style="color: #00ff00;">unsigned</span> <span style="color: #ffff00;">hashval</span>;



    <span style="color: #00ffff; font-weight: bold;">for</span> <span style="color: #93a8c6;">(</span>hashval = <span style="color: #ff00ff;">0</span>; *s != &#8242;\<span style="color: #ff00ff;">0</span>&#8242;; s++<span style="color: #93a8c6;">)</span>

        hashval = *s + <span style="color: #ff00ff;">31</span> * hashval;

    <span style="color: #00ffff; font-weight: bold;">return</span> hashval % <span style="color: #ff00ff;">HASHSIZE</span>;

<span style="color: #8c8c8c;">}</span>
</pre>
</div>

<p>
The reason we return `hashval % HASHSIZE` is because `hastab` only has a size of `HASHSIZE`. In this particular instance, the hash is placing the item in a arbitrary position from 0 to `HASHSIZE` - 1.
</p>

<p>
The hashing process produces a staring index in the array `hashtab`; if the string is to be found anywhere, it will be int he list of blocks beginning there. By this, it is meant that if there is a collision in the hashing, a list will be produced at that hash from which the for loop will search for the string name.
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #ffff00;">/* </span><span style="color: #ffff00;">lookup:  look for s in hashtab</span><span style="color: #ffff00;"> */</span>

<span style="color: #00ffff; font-weight: bold;">struct</span> <span style="color: #00ff00;">nlist</span> *<span style="color: #0000ff; font-weight: bold;">lookup</span><span style="color: #8c8c8c;">(</span><span style="color: #00ff00;">char</span> *<span style="color: #ffff00;">s</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">{</span>

    <span style="color: #00ffff; font-weight: bold;">struct</span> <span style="color: #00ff00;">nlist</span> *<span style="color: #ffff00;">np</span>;



    <span style="color: #00ffff; font-weight: bold;">for</span> <span style="color: #93a8c6;">(</span>np = hashtab<span style="color: #b0b1a3;">[</span>hash<span style="color: #8c8c8c;">(</span>s<span style="color: #8c8c8c;">)</span><span style="color: #b0b1a3;">]</span>; np != <span style="color: #ff00ff;">NULL</span>; np = np-&gt;next<span style="color: #93a8c6;">)</span>

        <span style="color: #00ffff; font-weight: bold;">if</span> <span style="color: #93a8c6;">(</span>strcmp<span style="color: #b0b1a3;">(</span>s, np-&gt;name<span style="color: #b0b1a3;">)</span> == <span style="color: #ff00ff;">0</span><span style="color: #93a8c6;">)</span>

            <span style="color: #00ffff; font-weight: bold;">return</span> np;  <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">found</span><span style="color: #ffff00;"> */</span>

    <span style="color: #00ffff; font-weight: bold;">return</span> <span style="color: #ff00ff;">NULL</span>;        <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">not found</span><span style="color: #ffff00;"> */</span>

<span style="color: #8c8c8c;">}</span>
</pre>
</div>

<p>
`install` returns a `NULL` if for any reason there is no room for a new entry.
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #00ffff; font-weight: bold;">struct</span> <span style="color: #00ff00;">nlist</span> *<span style="color: #0000ff; font-weight: bold;">lookup</span><span style="color: #8c8c8c;">(</span><span style="color: #00ff00;">char</span> *<span style="color: #8c8c8c;">)</span>;

<span style="color: #00ff00;">char</span> *<span style="color: #0000ff; font-weight: bold;">strdup</span><span style="color: #8c8c8c;">(</span><span style="color: #00ff00;">char</span> *<span style="color: #8c8c8c;">)</span>;



<span style="color: #ffff00;">/* </span><span style="color: #ffff00;">install:  put (name, defn) in hashtab</span><span style="color: #ffff00;"> */</span>

<span style="color: #00ffff; font-weight: bold;">struct</span> <span style="color: #00ff00;">nlist</span> *<span style="color: #0000ff; font-weight: bold;">install</span><span style="color: #8c8c8c;">(</span><span style="color: #00ff00;">char</span> *<span style="color: #ffff00;">name</span>, <span style="color: #00ff00;">char</span> *<span style="color: #ffff00;">defn</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">{</span>

    <span style="color: #00ffff; font-weight: bold;">struct</span> <span style="color: #00ff00;">nlist</span> *<span style="color: #ffff00;">np</span>;

    <span style="color: #00ff00;">unsigned</span> <span style="color: #ffff00;">hashval</span>;



    <span style="color: #00ffff; font-weight: bold;">if</span> <span style="color: #93a8c6;">(</span><span style="color: #b0b1a3;">(</span>np = lookup<span style="color: #8c8c8c;">(</span>name<span style="color: #8c8c8c;">)</span><span style="color: #b0b1a3;">)</span> == <span style="color: #ff00ff;">NULL</span><span style="color: #93a8c6;">)</span> <span style="color: #93a8c6;">{</span>  <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">not found</span><span style="color: #ffff00;"> */</span>

        np = <span style="color: #b0b1a3;">(</span><span style="color: #00ffff; font-weight: bold;">struct</span> <span style="color: #00ff00;">nlist</span> *<span style="color: #b0b1a3;">)</span> malloc<span style="color: #b0b1a3;">(</span><span style="color: #00ffff; font-weight: bold;">sizeof</span><span style="color: #8c8c8c;">(</span>*np<span style="color: #8c8c8c;">)</span><span style="color: #b0b1a3;">)</span>;

        <span style="color: #00ffff; font-weight: bold;">if</span> <span style="color: #b0b1a3;">(</span>np == <span style="color: #ff00ff;">NULL</span> &#166;&#166; <span style="color: #8c8c8c;">(</span>np-&gt;name = strdup<span style="color: #93a8c6;">(</span>name<span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span> == <span style="color: #ff00ff;">NULL</span><span style="color: #b0b1a3;">)</span>

            <span style="color: #00ffff; font-weight: bold;">return</span> <span style="color: #ff00ff;">NULL</span>;

        hashval = hash<span style="color: #b0b1a3;">(</span>name<span style="color: #b0b1a3;">)</span>;

        np-&gt;next = hashtab<span style="color: #b0b1a3;">[</span>hashval<span style="color: #b0b1a3;">]</span>;

        hashtab<span style="color: #b0b1a3;">[</span>hashval<span style="color: #b0b1a3;">]</span> = np;

    <span style="color: #93a8c6;">}</span> <span style="color: #00ffff; font-weight: bold;">else</span>      <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">already there</span><span style="color: #ffff00;"> */</span>

        free<span style="color: #93a8c6;">(</span><span style="color: #b0b1a3;">(</span><span style="color: #00ff00;">void</span> *<span style="color: #b0b1a3;">)</span> np-&gt;defn<span style="color: #93a8c6;">)</span>;  <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">free previous defn</span><span style="color: #ffff00;"> */</span>

    <span style="color: #00ffff; font-weight: bold;">if</span> <span style="color: #93a8c6;">(</span><span style="color: #b0b1a3;">(</span>np-&gt;defn = strdup<span style="color: #8c8c8c;">(</span>defn<span style="color: #8c8c8c;">)</span><span style="color: #b0b1a3;">)</span> == <span style="color: #ff00ff;">NULL</span><span style="color: #93a8c6;">)</span>

        <span style="color: #00ffff; font-weight: bold;">return</span> <span style="color: #ff00ff;">NULL</span>;

    <span style="color: #00ffff; font-weight: bold;">return</span> np;

<span style="color: #8c8c8c;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org89e7116" class="outline-2">
<h2 id="org89e7116">Input and Output</h2>
<div class="outline-text-2" id="text-org89e7116">
</div>
<div id="outline-container-orgf7771d7" class="outline-3">
<h3 id="orgf7771d7">Command Execution</h3>
<div class="outline-text-3" id="text-orgf7771d7">
<p>
The function `system(char* s)` executes the commands contained in the character string `s`, then resumes execution of the current program.
</p>

<div class="org-src-container">
<pre class="src src-C">system<span style="color: #8c8c8c;">(</span><span style="color: #00ff00;">"date"</span><span style="color: #8c8c8c;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc004e30" class="outline-3">
<h3 id="orgc004e30">Storage Management</h3>
<div class="outline-text-3" id="text-orgc004e30">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #00ff00;">void</span>* <span style="color: #0000ff; font-weight: bold;">malloc</span><span style="color: #8c8c8c;">(</span><span style="color: #00ff00;">size_t</span> <span style="color: #ffff00;">n</span><span style="color: #8c8c8c;">)</span>; <span style="color: #ffff00;">// </span><span style="color: #ffff00;">returns a pointer to n bytes of uninitialized storage</span>
<span style="color: #00ff00;">void</span>* <span style="color: #0000ff; font-weight: bold;">calloc</span><span style="color: #8c8c8c;">(</span><span style="color: #00ff00;">size_t</span> <span style="color: #ffff00;">n</span>, <span style="color: #00ff00;">size_t</span> <span style="color: #ffff00;">size</span><span style="color: #8c8c8c;">)</span>; <span style="color: #ffff00;">// </span><span style="color: #ffff00;">returns a pointer to enough space for an array of n objects of the specified size. </span>
<span style="color: #0000ff; font-weight: bold;">free</span><span style="color: #8c8c8c;">(</span>p<span style="color: #8c8c8c;">)</span>; <span style="color: #ffff00;">// </span><span style="color: #ffff00;">frees the space appointed to p where p was originally obtained by calling malloc or calloc.</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf473efd" class="outline-2">
<h2 id="orgf473efd">The UNIX System Interface</h2>
<div class="outline-text-2" id="text-orgf473efd">
</div>
<div id="outline-container-org2c2ddde" class="outline-3">
<h3 id="org2c2ddde">Open, Creat, Close, Unlink</h3>
<div class="outline-text-3" id="text-org2c2ddde">
<p>
Other than the default standard input, output and error, you must explicitly open files in order to read or write them (such as with I/O manipulation with external hardware).
</p>

<p>
There is a limit (often about 20) on the number of files that a program may have open simultaneously.
</p>
</div>
</div>

<div id="outline-container-org4be1eca" class="outline-3">
<h3 id="org4be1eca">Random Access - Lseek</h3>
<div class="outline-text-3" id="text-org4be1eca">
<p>
When necessary, a file can be read or written in any arbitrary order. The system call `lseek` provides a way to move around in a file without reading or writing any data:
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #00ff00;">long</span> <span style="color: #0000ff; font-weight: bold;">lseek</span><span style="color: #8c8c8c;">(</span><span style="color: #00ff00;">int</span> <span style="color: #ffff00;">fd</span>, <span style="color: #00ff00;">long</span> <span style="color: #ffff00;">offset</span>, <span style="color: #00ff00;">int</span> <span style="color: #ffff00;">origin</span><span style="color: #8c8c8c;">)</span>;
</pre>
</div>

<p>
`lseek` sets the position in the file whose descriptor is given. Subsequent reads and write will start at this point.
</p>
</div>
</div>

<div id="outline-container-orgfc2f1d0" class="outline-3">
<h3 id="orgfc2f1d0">Example - A Storage Allocator</h3>
<div class="outline-text-3" id="text-orgfc2f1d0">
<p>
This example creates a memory allocator that allows for non-continuous and/or segmented memory allocation as shown in Figure \ref{fig:storageexample}.
</p>

<p>
![An example of how the storage allocator will work \label{fig:storageexample}](<img src="https://learning.oreilly.com/library/view/the-c-programming/9780133086249/graphics/f0185_01.jpg" alt="f0185_01.jpg">).
</p>

<p>
`freep` is a list of pointers to the start of free areas of memory. The list contains structures of the form:
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #00ffff; font-weight: bold;">typedef</span> <span style="color: #00ff00;">long</span> <span style="color: #00ff00;">Align</span>;  <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">for alignment to long boundary</span><span style="color: #ffff00;"> */</span>



<span style="color: #00ffff; font-weight: bold;">union</span> <span style="color: #00ff00;">header</span> <span style="color: #8c8c8c;">{</span>       <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">block header:</span><span style="color: #ffff00;"> */</span>

    <span style="color: #00ffff; font-weight: bold;">struct</span> <span style="color: #93a8c6;">{</span>

        <span style="color: #00ffff; font-weight: bold;">union</span> <span style="color: #00ff00;">header</span> *<span style="color: #ffff00;">ptr</span>; <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">next block if on free list</span><span style="color: #ffff00;"> */</span>

        <span style="color: #00ff00;">unsigned</span> <span style="color: #ffff00;">size</span>;     <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">size of this block</span><span style="color: #ffff00;"> */</span>

    <span style="color: #93a8c6;">}</span> <span style="color: #ffff00;">s</span>;

    <span style="color: #00ff00;">Align</span> <span style="color: #ffff00;">x</span>;         <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">force alignment of blocks</span><span style="color: #ffff00;"> */</span>

<span style="color: #8c8c8c;">}</span>;



<span style="color: #00ffff; font-weight: bold;">typedef</span> <span style="color: #00ffff; font-weight: bold;">union</span> <span style="color: #00ff00;">header</span> <span style="color: #00ff00;">Header</span>;
</pre>
</div>

<p>
The overridden `malloc` method has the form of:
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #00ffff; font-weight: bold;">static</span> <span style="color: #00ff00;">Header</span> <span style="color: #ffff00;">base</span>;       <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">empty list to get started</span><span style="color: #ffff00;"> */</span>

<span style="color: #00ffff; font-weight: bold;">static</span> <span style="color: #00ff00;">Header</span> *<span style="color: #ffff00;">freep</span> = <span style="color: #ff00ff;">NULL</span>;     <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">start of free list</span><span style="color: #ffff00;"> */</span>



<span style="color: #ffff00;">/* </span><span style="color: #ffff00;">malloc:  general-purpose storage allocator</span><span style="color: #ffff00;"> */</span>

<span style="color: #00ff00;">void</span> *<span style="color: #0000ff; font-weight: bold;">malloc</span><span style="color: #8c8c8c;">(</span><span style="color: #00ff00;">unsigned</span> <span style="color: #ffff00;">nbytes</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">{</span>

    <span style="color: #00ff00;">Header</span> *<span style="color: #ffff00;">p</span>, *<span style="color: #ffff00;">prevp</span>;

    <span style="color: #00ff00;">Header</span> *<span style="color: #0000ff; font-weight: bold;">morecore</span><span style="color: #93a8c6;">(</span><span style="color: #00ff00;">unsigned</span><span style="color: #93a8c6;">)</span>;

    <span style="color: #00ff00;">unsigned</span> <span style="color: #ffff00;">nunits</span>;



    nunits = <span style="color: #93a8c6;">(</span>nbytes+<span style="color: #00ffff; font-weight: bold;">sizeof</span><span style="color: #b0b1a3;">(</span>Header<span style="color: #b0b1a3;">)</span>&#8722;<span style="color: #ff00ff;">1</span><span style="color: #93a8c6;">)</span>/<span style="color: #00ffff; font-weight: bold;">sizeof</span><span style="color: #93a8c6;">(</span>Header<span style="color: #93a8c6;">)</span> + <span style="color: #ff00ff;">1</span>;

    <span style="color: #00ffff; font-weight: bold;">if</span> <span style="color: #93a8c6;">(</span><span style="color: #b0b1a3;">(</span>prevp = freep<span style="color: #b0b1a3;">)</span> == <span style="color: #ff00ff;">NULL</span><span style="color: #93a8c6;">)</span> <span style="color: #93a8c6;">{</span>  <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">no free list yet</span><span style="color: #ffff00;"> */</span>

        base.s.ptr = freep = prevp = &amp;base;

        base.s.size = <span style="color: #ff00ff;">0</span>;

    <span style="color: #93a8c6;">}</span>

    <span style="color: #00ffff; font-weight: bold;">for</span> <span style="color: #93a8c6;">(</span>p = prevp-&gt;s.ptr; ; prevp = p, p = p-&gt;s.ptr<span style="color: #93a8c6;">)</span> <span style="color: #93a8c6;">{</span>

        <span style="color: #00ffff; font-weight: bold;">if</span> <span style="color: #b0b1a3;">(</span>p-&gt;s.size &gt;= nunits<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>    <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">big enough</span><span style="color: #ffff00;"> */</span>

            <span style="color: #00ffff; font-weight: bold;">if</span> <span style="color: #8c8c8c;">(</span>p-&gt;s.size == nunits<span style="color: #8c8c8c;">)</span>     <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">exactly</span><span style="color: #ffff00;"> */</span>

                prevp-&gt;s.ptr = p-&gt;s.ptr;

            <span style="color: #00ffff; font-weight: bold;">else</span> <span style="color: #8c8c8c;">{</span>             <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">allocate tail end</span><span style="color: #ffff00;"> */</span>

                p-&gt;s.size -= nunits;

                p += p-&gt;s.size;

                p-&gt;s.size = nunits;

            <span style="color: #8c8c8c;">}</span>

            freep = prevp;

            <span style="color: #00ffff; font-weight: bold;">return</span> <span style="color: #8c8c8c;">(</span><span style="color: #00ff00;">void</span> *<span style="color: #8c8c8c;">)(</span>p+<span style="color: #ff00ff;">1</span><span style="color: #8c8c8c;">)</span>;

        <span style="color: #b0b1a3;">}</span>

        <span style="color: #00ffff; font-weight: bold;">if</span> <span style="color: #b0b1a3;">(</span>p == freep<span style="color: #b0b1a3;">)</span>  <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">wrapped around free list</span><span style="color: #ffff00;"> */</span>

            <span style="color: #00ffff; font-weight: bold;">if</span> <span style="color: #b0b1a3;">(</span><span style="color: #8c8c8c;">(</span>p = morecore<span style="color: #93a8c6;">(</span>nunits<span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span> == <span style="color: #ff00ff;">NULL</span><span style="color: #b0b1a3;">)</span>

                <span style="color: #00ffff; font-weight: bold;">return</span> <span style="color: #ff00ff;">NULL</span>;   <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">none left</span><span style="color: #ffff00;"> */</span>

    <span style="color: #93a8c6;">}</span>

<span style="color: #8c8c8c;">}</span>
</pre>
</div>

<p>
Where `morecore` is used to obtain more storage from the operating system.
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #0000ff; font-weight: bold;">#define</span>    <span style="color: #ffff00;">NALLOC</span>    <span style="color: #ff00ff;">1024</span>    <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">minimum #units to request</span><span style="color: #ffff00;"> */</span>



<span style="color: #ffff00;">/* </span><span style="color: #ffff00;">morecore:  ask system for more memory</span><span style="color: #ffff00;"> */</span>

<span style="color: #00ffff; font-weight: bold;">static</span> <span style="color: #00ff00;">Header</span> *<span style="color: #0000ff; font-weight: bold;">morecore</span><span style="color: #8c8c8c;">(</span><span style="color: #00ff00;">unsigned</span> <span style="color: #ffff00;">nu</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">{</span>

    <span style="color: #00ff00;">char</span> *<span style="color: #ffff00;">cp</span>, *<span style="color: #0000ff; font-weight: bold;">sbrk</span><span style="color: #93a8c6;">(</span><span style="color: #00ff00;">int</span><span style="color: #93a8c6;">)</span>;

    <span style="color: #00ff00;">Header</span> *<span style="color: #ffff00;">up</span>;



    <span style="color: #00ffff; font-weight: bold;">if</span> <span style="color: #93a8c6;">(</span>nu &lt; <span style="color: #ff00ff;">NALLOC</span><span style="color: #93a8c6;">)</span>

        nu = <span style="color: #ff00ff;">NALLOC</span>;

    cp = sbrk<span style="color: #93a8c6;">(</span>nu * <span style="color: #00ffff; font-weight: bold;">sizeof</span><span style="color: #b0b1a3;">(</span>Header<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span>;

    <span style="color: #00ffff; font-weight: bold;">if</span> <span style="color: #93a8c6;">(</span>cp == <span style="color: #b0b1a3;">(</span><span style="color: #00ff00;">char</span> *<span style="color: #b0b1a3;">)</span> &#8722;<span style="color: #ff00ff;">1</span><span style="color: #93a8c6;">)</span>    <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">no space at all</span><span style="color: #ffff00;"> */</span>

        <span style="color: #00ffff; font-weight: bold;">return</span> <span style="color: #ff00ff;">NULL</span>;

    up = <span style="color: #93a8c6;">(</span><span style="color: #00ff00;">Header</span> *<span style="color: #93a8c6;">)</span> cp;

    up-&gt;s.size = nu;

    free<span style="color: #93a8c6;">(</span><span style="color: #b0b1a3;">(</span><span style="color: #00ff00;">void</span> *<span style="color: #b0b1a3;">)(</span>up+<span style="color: #ff00ff;">1</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span>;

    <span style="color: #00ffff; font-weight: bold;">return</span> freep;

<span style="color: #8c8c8c;">}</span>
</pre>
</div>

<p>
`free` is the last thing. It scans the free list looking for the place to insert the free block. This is either between two existing blocks or at one end of the list. In any case, if th block being freed is adjacent to either neighbor, the adjacent blocks are combined.
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #ffff00;">/* </span><span style="color: #ffff00;">free:  put block ap in free list</span><span style="color: #ffff00;"> */</span>

<span style="color: #00ff00;">void</span> <span style="color: #0000ff; font-weight: bold;">free</span><span style="color: #8c8c8c;">(</span><span style="color: #00ff00;">void</span> *<span style="color: #ffff00;">ap</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">{</span>

    <span style="color: #00ff00;">Header</span> *<span style="color: #ffff00;">bp</span>, *<span style="color: #ffff00;">p</span>;



    bp = <span style="color: #93a8c6;">(</span><span style="color: #00ff00;">Header</span> *<span style="color: #93a8c6;">)</span>ap - <span style="color: #ff00ff;">1</span>;    <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">point to block header</span><span style="color: #ffff00;"> */</span>

    <span style="color: #00ffff; font-weight: bold;">for</span> <span style="color: #93a8c6;">(</span>p = freep; !<span style="color: #b0b1a3;">(</span>bp &gt; p &amp;&amp; bp &lt; p-&gt;s.ptr<span style="color: #b0b1a3;">)</span>; p = p-&gt;s.ptr<span style="color: #93a8c6;">)</span>

        <span style="color: #00ffff; font-weight: bold;">if</span> <span style="color: #93a8c6;">(</span>p &gt;= p-&gt;s.ptr &amp;&amp; <span style="color: #b0b1a3;">(</span>bp &gt; p &#166;&#166; bp &lt; p-&gt;s.ptr<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span>

            <span style="color: #00ffff; font-weight: bold;">break</span>;  <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">freed block at start or end of arena</span><span style="color: #ffff00;"> */</span>



    <span style="color: #00ffff; font-weight: bold;">if</span> <span style="color: #93a8c6;">(</span>bp + bp-&gt;s.size == p-&gt;s.ptr<span style="color: #93a8c6;">)</span> <span style="color: #93a8c6;">{</span> <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">join to upper nbr</span><span style="color: #ffff00;"> */</span>

        bp-&gt;s.size += p-&gt;s.ptr-&gt;s.size;

        bp-&gt;s.ptr = p-&gt;s.ptr-&gt;s.ptr;

    <span style="color: #93a8c6;">}</span> <span style="color: #00ffff; font-weight: bold;">else</span>

        bp-&gt;s.ptr = p-&gt;s.ptr;

    <span style="color: #00ffff; font-weight: bold;">if</span> <span style="color: #93a8c6;">(</span>p + p-&gt;s.size == bp<span style="color: #93a8c6;">)</span> <span style="color: #93a8c6;">{</span>         <span style="color: #ffff00;">/* </span><span style="color: #ffff00;">join to lower nbr</span><span style="color: #ffff00;"> */</span>

        p-&gt;s.size += bp-&gt;s.size;

        p-&gt;s.ptr = bp-&gt;s.ptr;

    <span style="color: #93a8c6;">}</span> <span style="color: #00ffff; font-weight: bold;">else</span>

        p-&gt;s.ptr = bp;

    freep = p;

<span style="color: #8c8c8c;">}</span>
</pre>
</div>
</div>
</div>
</div>
<div class="taglist"></div></div>
<div id="postamble" class="status"><div id="archive">
  <a href="https://alexb7711.github.io/archive.html">Other posts</a>
</div></div>
</body>
</html>
